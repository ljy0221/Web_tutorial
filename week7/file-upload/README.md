# Node.js와 Express에서 파일 업로드 구현하기

## 파일 업로드의 두 가지 측면

### 클라이언트 측 (브라우저)

1. **파일 선택 및 미리보기**

   - 사용자가 파일을 선택할 수 있는 UI 제공
   - 선택한 파일의 미리보기 옵션 (이미지인 경우)

2. **폼 제출**
   - 선택한 파일과 기타 데이터를 포함한 폼 제출
   - 멀티파트/폼-데이터(multipart/form-data) 인코딩 타입 사용

#### multipart/form-data 인코딩 타입을 사용하는 이유

- 일반 폼 데이터(application/x-www-form-urlencoded)는 텍스트 데이터만 효율적으로 전송
- 파일은 바이너리 데이터이므로 특별한 인코딩이 필요함
- multipart/form-data는 텍스트 필드와 바이너리 파일을 함께 전송할 수 있는 유일한 HTML 폼 인코딩 타입
- 각 필드와 파일을 "파트(part)"로 구분하여 하나의 요청에 여러 유형의 데이터 포함 가능

```html
<form action="/upload" method="POST" enctype="multipart/form-data">
  <input type="file" name="image" />
  <input type="text" name="title" />
  <button type="submit">업로드</button>
</form>
```

## express.urlencoded() 미들웨어를 사용하는 이유

`app.use(express.urlencoded({ extended: false }));` 설정은 다음과 같은 이유로 사용됩니다:

1. **HTML 폼 데이터 파싱**

   - HTML 폼에서 제출된 데이터(application/x-www-form-urlencoded 콘텐츠 타입)를 파싱
   - 파싱된 데이터는 `req.body` 객체로 접근 가능

2. **extended 옵션의 의미**

   - `extended: false`: querystring 라이브러리를 사용하여 URL 인코딩 데이터를 파싱
     - 중첩 객체를 지원하지 않음
     - 간단한 키-값 쌍만 처리
   - `extended: true`: qs 라이브러리를 사용하여 파싱
     - 중첩 객체와 배열 지원
     - 더 복잡한 데이터 구조 처리 가능

3. **파일 업로드와의 관계**
   - 중요: `urlencoded` 미들웨어는 `multipart/form-data`(파일 업로드에 사용)를 처리하지 않음
   - 파일 업로드는 multer와 같은 별도 미들웨어로 처리
   - 일반적으로 폼에는 파일 외에도 텍스트 필드가 포함되므로, 두 미들웨어를 함께 사용하는 경우가 많음

### 서버 측

1. **파일 추출**

   - 들어오는 요청에서 파일 데이터 추출
   - 다른 폼 데이터와 함께 처리

2. **파일 저장 및 제공**
   - 파일을 서버에 저장
   - 저장된 파일에 접근할 수 있는 경로 제공

## 파일 저장 위치 선택

### 데이터베이스 vs 파일 시스템

**데이터베이스에 저장하지 않는 이유:**

- 데이터베이스는 파일 저장 및 검색에 최적화되어 있지 않음
- 대용량 파일의 경우 데이터베이스 성능 저하
- 백업 및 복원 과정이 복잡해짐

**권장 방식:**

- 파일은 파일 시스템(하드 드라이브)에 저장
- 데이터베이스에는 파일 경로만 저장
- 이를 통해 파일 관리와 데이터베이스 관리 분리

**클라우드 스토리지 활용 방법**

- 로컬 파일 시스템 외에도 클라우드 스토리지 서비스를 활용하여 파일을 저장할 수 있습니다:

## Node.js에서 파일 업로드 구현하기

### 필요한 패키지

- **multer**: Express에서 파일 업로드를 처리하기 위한 미들웨어
- **fs**: 파일 시스템 작업을 위한 Node.js 내장 모듈
